---
layout: post
title: Anomaly detection with autoencoders (10 mins read) 
---


<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>



In this blog post we will use autoencoders to detect anomalies in ECG5000 dataset. In writing this blog post I have assumed that the reader has some basic understanding of neural networks and autoencoders as a specific type of neural network. Jeremy Jordan has a nice 10mins-read blog post on autoencoders, you can find it [here](https://www.jeremyjordan.me/autoencoders/).  The ECG5000 dataset which we will use contains 50,000 Electrocardiograms (ECG). Each cardiogram has 140 data points.  Luckily for us, the data has been labeled into a normal and abnormal rhythm by medical experts. Our goal is to use autoencoders to see if they can mimic the knowledge of a medical doctor and identify abnormal Electrocardiograms.

Our approach will be to (1) train the autoencoder on the normal data and (2) use our trained model to reconstruct the entire dataset. We hypothesize that abnormal Electrocardiograms will have a higher reconstruction error. Recall that an autoencoder takes the input data and projects it onto a lower-dimensional space that captures only the signals in the data. The data can then be reconstructed from the lower-dimensional space. Note here that if a data point is noisy its reconstruction error (the distance between the actual point and the reconstructed one) will be large. It is this simple principle that we use to identity anomalies. 


## Lets load the ECG data 


```python
# libraries 
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import tensorflow as tf


from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score, precision_score, recall_score
from tensorflow.keras import layers, losses
from tensorflow.keras.datasets import fashion_mnist
from tensorflow.keras.models import Model
import plotly.express as px 
import plotly.graph_objects as go 
import plotly.offline as py_offline
```


```python
# Download the dataset
url = 'http://storage.googleapis.com/download.tensorflow.org/data/ecg.csv'

dataframe = pd.read_csv(url,header=None)
raw_data = dataframe.values
# first five rows and columns
print(dataframe.iloc[:,0:5].head().to_markdown())
```

    |    |         0 |         1 |        2 |        3 |        4 |
    |---:|----------:|----------:|---------:|---------:|---------:|
    |  0 | -0.112522 | -2.8272   | -3.7739  | -4.34975 | -4.37604 |
    |  1 | -1.10088  | -3.99684  | -4.28584 | -4.50658 | -4.02238 |
    |  2 | -0.567088 | -2.59345  | -3.87423 | -4.58409 | -4.18745 |
    |  3 |  0.490473 | -1.91441  | -3.61636 | -4.31882 | -4.26802 |
    |  4 |  0.800232 | -0.874252 | -2.38476 | -3.97329 | -4.33822 |


The last column contains the labels. The other data points are the electrocardiogram data. We will also create a train and test a dataset, as well as their labels, this is what data scientists do to overcome a serious problem in data science namely `over-fitting`.


```python
# The last element contains the labels
labels = raw_data[:, -1]

# The other data points are the electrocadriogram data
data = raw_data[:, 0:-1]

train_data, test_data, train_labels, test_labels = train_test_split(
    data, labels, test_size=0.2, random_state=21
)
```

We will also normalize the data to lie between [0,1]. Note here that we do normalization because to speed up the learning and convergence of the optimizer. 


```python
min_val = tf.reduce_min(train_data)
max_val = tf.reduce_max(train_data)

train_data = (train_data - min_val) / (max_val - min_val)
test_data = (test_data - min_val) / (max_val - min_val)

train_data = tf.cast(train_data, tf.float32)
test_data = tf.cast(test_data, tf.float32)
```


As mentioned earlier, we will only train the autoencoder on the data with normal rhythms. Electrocardiograms with normal rhythm are labeled with 1. We will separate the normal rhythm from the abnormal ones in the following chunk of code.


```python
train_labels = train_labels.astype(bool)
test_labels = test_labels.astype(bool)

normal_train_data = train_data[train_labels]
normal_test_data = test_data[test_labels]


abnormal_train_data = train_data[~train_labels]
abnormal_test_data = test_data[~test_labels]
```

Let's visualize a normal and an abnormal  ECG. 


```python
fig = go.Figure()
trace1 = go.Scatter(x=np.arange(140), y=normal_train_data[0],name='Normal')
trace2 = go.Scatter(x=np.arange(140), y=abnormal_train_data[0],name='Abnormal')
data = [trace1,trace2]
py_offline.plot(data, filename='basic-line', include_plotlyjs=False, output_type='div')


```
<div>                            <div id="df570e40-a9ee-4b30-9e74-8952a20a474b" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("df570e40-a9ee-4b30-9e74-8952a20a474b")) {                    Plotly.newPlot(                        "df570e40-a9ee-4b30-9e74-8952a20a474b",                        [{"name":"Normal","type":"scatter","x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139],"y":[0.5703046321868896,0.4656165838241577,0.2905811667442322,0.17791584134101868,0.09538919478654861,0.08467857539653778,0.2019510418176651,0.3163002133369446,0.33732032775878906,0.41424882411956787,0.47070595622062683,0.4691905081272125,0.4776775538921356,0.48004090785980225,0.4702724516391754,0.4729926884174347,0.479171484708786,0.48027467727661133,0.46928870677948,0.46106863021850586,0.46148037910461426,0.4465829133987427,0.45325326919555664,0.4561009407043457,0.4489617943763733,0.44325318932533264,0.4340217411518097,0.4430723488330841,0.4325052499771118,0.43014901876449585,0.41454657912254333,0.4120652973651886,0.40420278906822205,0.4105454385280609,0.4082913100719452,0.40342992544174194,0.39648476243019104,0.3933204412460327,0.39158815145492554,0.3960387706756592,0.4074695408344269,0.40531179308891296,0.41734880208969116,0.41624557971954346,0.42334118485450745,0.4459063708782196,0.4455184042453766,0.44474098086357117,0.44404327869415283,0.4567321836948395,0.4521746337413788,0.4532504081726074,0.46082931756973267,0.4669593572616577,0.4663194417953491,0.47432830929756165,0.46297091245651245,0.4738894999027252,0.4678889811038971,0.4673447906970978,0.4802667498588562,0.48439839482307434,0.48574668169021606,0.48985567688941956,0.4931734800338745,0.48830410838127136,0.49913936853408813,0.505709171295166,0.5078241229057312,0.5132302641868591,0.5211992859840393,0.514991819858551,0.519900918006897,0.5074853897094727,0.5113434195518494,0.5092939734458923,0.5073481798171997,0.5110538005828857,0.5096123814582825,0.4963955879211426,0.49456536769866943,0.5014910101890564,0.5063670873641968,0.5020293593406677,0.5007152557373047,0.4958237409591675,0.4843623638153076,0.4914246201515198,0.4825357496738434,0.47723883390426636,0.47550636529922485,0.47530031204223633,0.4876338243484497,0.4776129722595215,0.474583238363266,0.4757544696331024,0.47009119391441345,0.4540967047214508,0.46874862909317017,0.4767007529735565,0.4795878529548645,0.4751480519771576,0.47619494795799255,0.48561891913414,0.48763763904571533,0.4996277689933777,0.5284430384635925,0.5431970953941345,0.5495933294296265,0.5488370060920715,0.5231477618217468,0.4934438467025757,0.49881476163864136,0.5099680423736572,0.516133189201355,0.4907889664173126,0.4668024778366089,0.43299439549446106,0.4164400100708008,0.4182245135307312,0.43140411376953125,0.43214115500450134,0.4212411642074585,0.42373567819595337,0.42885276675224304,0.43089887499809265,0.43537637591362,0.4391244351863861,0.4371418356895447,0.4453428089618683,0.4533092975616455,0.48821336030960083,0.5786804556846619,0.5858615636825562,0.5959517955780029,0.5952476263046265,0.5700759291648865,0.4850423336029053,0.42335018515586853,0.4759834408760071]},{"name":"Abnormal","type":"scatter","x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139],"y":[0.4304001033306122,0.35345321893692017,0.3034263849258423,0.2818489074707031,0.28353944420814514,0.28959953784942627,0.3114522695541382,0.3470645248889923,0.3809654414653778,0.39506226778030396,0.3976452350616455,0.41356122493743896,0.4387162923812866,0.4520491063594818,0.4495706260204315,0.44956129789352417,0.45499545335769653,0.45426806807518005,0.44863343238830566,0.45084789395332336,0.45330581068992615,0.4520796537399292,0.4475529193878174,0.44939249753952026,0.4473649561405182,0.44874852895736694,0.4485017955303192,0.4462437331676483,0.44809791445732117,0.4483480751514435,0.44390979409217834,0.44208911061286926,0.4433857798576355,0.44462850689888,0.43986889719963074,0.4404641091823578,0.4400186240673065,0.43668332695961,0.4339315891265869,0.4317610263824463,0.4295136630535126,0.4274426996707916,0.42877644300460815,0.42894187569618225,0.4254743754863739,0.42517906427383423,0.42631953954696655,0.4277213215827942,0.42250746488571167,0.42367860674858093,0.4281102418899536,0.4270593523979187,0.4272007346153259,0.4308776557445526,0.4309622049331665,0.43490204215049744,0.43578556180000305,0.43896228075027466,0.44403478503227234,0.4491182863712311,0.453519344329834,0.4524179995059967,0.45339763164520264,0.45347079634666443,0.45640361309051514,0.45917513966560364,0.45685112476348877,0.45898863673210144,0.4569636881351471,0.45675793290138245,0.46130383014678955,0.45900118350982666,0.46151021122932434,0.46561598777770996,0.4587060809135437,0.4582265317440033,0.4626377522945404,0.4621920883655548,0.4627910554409027,0.46581798791885376,0.4644567370414734,0.4647052586078644,0.46456974744796753,0.4647565186023712,0.46593987941741943,0.46568334102630615,0.46936455368995667,0.47205060720443726,0.4691234230995178,0.4770551025867462,0.4743116497993469,0.4712502956390381,0.476502001285553,0.4755341112613678,0.47373101115226746,0.47748467326164246,0.48040735721588135,0.47647133469581604,0.4788639545440674,0.48452094197273254,0.4846736788749695,0.4795249104499817,0.4818657338619232,0.4819636642932892,0.48308029770851135,0.47801387310028076,0.48302972316741943,0.48857638239860535,0.48736441135406494,0.49351075291633606,0.49945521354675293,0.505765438079834,0.5169975757598877,0.527177631855011,0.5347791314125061,0.544451892375946,0.5556207895278931,0.5749051570892334,0.5851321816444397,0.5897799730300903,0.5978419184684753,0.6050950884819031,0.6238124370574951,0.6344885230064392,0.6365599036216736,0.6482247710227966,0.6608508229255676,0.6543368697166443,0.6259334683418274,0.5985985398292542,0.5772880911827087,0.5069698095321655,0.423368364572525,0.395474374294281,0.3666984438896179,0.35847392678260803,0.34862595796585083,0.3050689399242401,0.2622550129890442,0.25020110607147217]}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}}},                        {"responsive": true}                    )                };                            </script>        </div>



Observe that there is a huge discrepancy between the normal and abnormal graphs for large values on the x-axis. We will now build an autoencoder that will encode the normal data.

Build the model. Here we will use `Kera`'s sequential API, with three dense layers for the encoder and three dense layers for the decoder. We will create an `AnormlyDectector` class that inherits from the `Model` class. 


```python
class AnomalyDetector(Model):
  def __init__(self):
    super(AnomalyDetector, self).__init__()
    self.encoder = tf.keras.Sequential([
      layers.Dense(32, activation="relu"),
      layers.Dense(16, activation="relu"),
      layers.Dense(8, activation="relu")])

    self.decoder = tf.keras.Sequential([
      layers.Dense(16, activation="relu"),
      layers.Dense(32, activation="relu"),
      layers.Dense(140, activation="sigmoid")])

  def call(self, x):
    encoded = self.encoder(x)
    decoded = self.decoder(encoded)
    return decoded

autoencoder = AnomalyDetector()
```

Note that the call method in the `AnormalyDetector` class combines the `encoder` and `decoder` and returns the `decoder` object. Let's `compile`, compilation here will mean we will update our `autoencoder` object with an `optimizer` and a `loss` function. We are using the mean absolute error loss defined as:

$$
\text{mae} = \frac{1}{n}\sum_{i=1}^n{|y_i-\hat{y}_i|}.
$$

Where in this simple formular, we have $n$ data points $$ i = 1,2,...,n$$, $$y_i $$ refers to the actual (true/observed) data point and $$\hat{y}_i$$ is its estimate. In our use case, $$y_i$$ is the actual ECG and $$\hat{y}_i$$ will be its reconstructed version.


```python
autoencoder.compile(optimizer='adam', loss='mae')
```

We now train the `autoencoder` by calling its fit method using only the normal rhythm ECG.


```python
history = autoencoder.fit(normal_train_data, normal_train_data, 
          epochs=40, 
          batch_size=1024,
          validation_data=(test_data, test_data),
          shuffle=True)
```

    2021-07-01 23:30:53.389957: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:176] None of the MLIR Optimization Passes are enabled (registered 2)
    2021-07-01 23:30:53.407961: I tensorflow/core/platform/profile_utils/cpu_utils.cc:114] CPU Frequency: 2299965000 Hz
    Epoch 1/40
    3/3 [==============================] - 1s 68ms/step - loss: 0.0583 - val_loss: 0.0538
    Epoch 2/40
    3/3 [==============================] - 0s 12ms/step - loss: 0.0572 - val_loss: 0.0529
    Epoch 3/40
    3/3 [==============================] - 0s 13ms/step - loss: 0.0560 - val_loss: 0.0516
    Epoch 4/40
   


Note that although, the training is done on the normal rythm ECG, the validation is done on the entire test dataset. 


```python
trace1 = go.Scatter(y=history.history["loss"],name='Training loss')
trace2 = go.Scatter(y=history.history["val_loss"],name="Validation Loss")

data = [trace1,trace2]
py_offline.plot(data, filename='basic-line', include_plotlyjs=False, output_type='div')
```
 <div>                            <div id="9a253f0c-d785-4a32-8fb4-40fba092d1ae" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("9a253f0c-d785-4a32-8fb4-40fba092d1ae")) {                    Plotly.newPlot(                        "9a253f0c-d785-4a32-8fb4-40fba092d1ae",                        [{"name":"Training loss","type":"scatter","y":[0.058278534561395645,0.05722469091415405,0.055976081639528275,0.05413749814033508,0.05195949599146843,0.04983977600932121,0.047649431973695755,0.045335717499256134,0.042959924787282944,0.04062921181321144,0.03834312781691551,0.03613226115703583,0.034103430807590485,0.032226432114839554,0.030500391498208046,0.028956780210137367,0.027625905349850655,0.026466840878129005,0.02543344534933567,0.024553125724196434,0.023776769638061523,0.023114116862416267,0.022525107488036156,0.02204899489879608,0.021653564646840096,0.021222712472081184,0.020815474912524223,0.02050328254699707,0.020228561013936996,0.01997336931526661,0.019709087908267975,0.019487522542476654,0.019291188567876816,0.019120845943689346,0.018972262740135193,0.01884193904697895,0.01869540847837925,0.018570875748991966,0.018489936366677284,0.018385285511612892]},{"name":"Validation Loss","type":"scatter","y":[0.05377873405814171,0.05285775288939476,0.05161994323134422,0.050348639488220215,0.049337007105350494,0.04812619462609291,0.04682121425867081,0.04544347524642944,0.04408815875649452,0.04306970164179802,0.04215961694717407,0.041414909064769745,0.040336973965168,0.03945089876651764,0.03880546614527702,0.0382448211312294,0.037505149841308594,0.0367407463490963,0.03622050955891609,0.035524141043424606,0.035079870373010635,0.034299202263355255,0.03374018892645836,0.033646248281002045,0.03341890498995781,0.032838888466358185,0.032575566321611404,0.032258376479148865,0.032065022736787796,0.03204252943396568,0.032129280269145966,0.032059311866760254,0.03175316005945206,0.03152251988649368,0.031246867030858994,0.03106059320271015,0.03096027299761772,0.031274210661649704,0.031148653477430344,0.03088766522705555]}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}}},                        {"responsive": true}                    )                };                            </script>        </div>



## Reconstruction error

We now have a model that can encode and decode ECG. Let's use the model to reconstruct a particular ECG and check the reconstruction error, i.e., the difference between the actual ECG and its reconstruction. 



```python
encoded_data = autoencoder.encoder(normal_test_data).numpy()
decoded_data = autoencoder.decoder(encoded_data).numpy()


trace1 = go.Scatter(y=normal_test_data[0],name='Input data')
trace2 = go.Scatter(y=decoded_data[0],name='Reconstruction & error',
                         fill='tonexty')

data = [trace1,trace2]
py_offline.plot(data, filename='basic-line', include_plotlyjs=False, output_type='div')

```
<div>                            <div id="dcc55352-bca6-4c4c-aac4-ad4200bf7f8a" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("dcc55352-bca6-4c4c-aac4-ad4200bf7f8a")) {                    Plotly.newPlot(                        "dcc55352-bca6-4c4c-aac4-ad4200bf7f8a",                        [{"name":"Input data","type":"scatter","y":[0.48035767674446106,0.2887779176235199,0.19828546047210693,0.17403002083301544,0.19065187871456146,0.2570231258869171,0.35133999586105347,0.3795180916786194,0.41933903098106384,0.47931399941444397,0.5085671544075012,0.5021305084228516,0.4981786012649536,0.5009568333625793,0.4963546097278595,0.4957442283630371,0.49634596705436707,0.4871847927570343,0.49864014983177185,0.49027618765830994,0.48405030369758606,0.4853919446468353,0.4781576991081238,0.4776414632797241,0.4754825830459595,0.4680434465408325,0.4633431136608124,0.4667298495769501,0.4565943777561188,0.45639845728874207,0.44269412755966187,0.4387221038341522,0.4350164234638214,0.4311322867870331,0.43271467089653015,0.43053433299064636,0.4260518252849579,0.4177199602127075,0.4224426746368408,0.4249061048030853,0.4222816526889801,0.4255194664001465,0.427318811416626,0.4344993233680725,0.43405434489250183,0.4319981336593628,0.4433560073375702,0.4449458420276642,0.4500327408313751,0.44775307178497314,0.45146772265434265,0.4631691873073578,0.4599079489707947,0.4583589732646942,0.46505701541900635,0.4695504903793335,0.48476895689964294,0.4720330536365509,0.47590193152427673,0.48128950595855713,0.48106202483177185,0.483425110578537,0.4797944724559784,0.49654191732406616,0.497626930475235,0.5003345012664795,0.4999160170555115,0.4998267590999603,0.5085312724113464,0.5027685165405273,0.5192650556564331,0.5174381136894226,0.5176679491996765,0.5243684649467468,0.522845447063446,0.523930549621582,0.5308157205581665,0.5383780002593994,0.5319925546646118,0.5184898376464844,0.5222746729850769,0.5139047503471375,0.5156378149986267,0.5147913098335266,0.5096921324729919,0.5125722289085388,0.5018595457077026,0.49053633213043213,0.48884034156799316,0.4823535084724426,0.47934600710868835,0.48330995440483093,0.4766990542411804,0.47691449522972107,0.4795263111591339,0.4947693347930908,0.5108534097671509,0.5188336968421936,0.5332105159759521,0.5425611138343811,0.5682035684585571,0.5826812386512756,0.6099961996078491,0.6065466403961182,0.5954951047897339,0.5819999575614929,0.5612176060676575,0.5507384538650513,0.5170336961746216,0.4897701144218445,0.4583636224269867,0.41286134719848633,0.3860044479370117,0.3743003010749817,0.37155696749687195,0.36838045716285706,0.3640936613082886,0.3643512427806854,0.3664138913154602,0.3565950393676758,0.3636854290962219,0.3610741198062897,0.3605392873287201,0.3603725731372833,0.36098870635032654,0.3649810552597046,0.3636249601840973,0.36424019932746887,0.3778349459171295,0.4150768220424652,0.4684041142463684,0.46837979555130005,0.48350921273231506,0.4904227554798126,0.4625466465950012,0.43603575229644775,0.4314790964126587,0.45463305711746216,0.5246124863624573,0.37137290835380554]},{"fill":"tonexty","name":"Reconstruction & error","type":"scatter","y":[0.4465961456298828,0.3107976019382477,0.21133604645729065,0.18289929628372192,0.18875935673713684,0.2345043122768402,0.3434072732925415,0.3885255455970764,0.36512336134910583,0.42534133791923523,0.4633747935295105,0.4717438817024231,0.44047656655311584,0.4607338607311249,0.4668833911418915,0.46644940972328186,0.48185503482818604,0.46478328108787537,0.4626923203468323,0.4700751006603241,0.46916255354881287,0.4654800295829773,0.4807877540588379,0.46511152386665344,0.46649792790412903,0.4589080512523651,0.43502575159072876,0.45252928137779236,0.4419180750846863,0.4393032193183899,0.42319244146347046,0.44804516434669495,0.4537696838378906,0.4307486116886139,0.4432544410228729,0.43226516246795654,0.438921183347702,0.41973650455474854,0.4481489062309265,0.4237235188484192,0.4533311128616333,0.4676003158092499,0.45611345767974854,0.44850221276283264,0.4738155007362366,0.47608277201652527,0.4773779809474945,0.47266486287117004,0.4874640107154846,0.4830182194709778,0.482825368642807,0.4895108938217163,0.47653865814208984,0.4739570915699005,0.4788680672645569,0.46779096126556396,0.4797886908054352,0.4860452711582184,0.48060664534568787,0.4844375252723694,0.47528624534606934,0.4678887724876404,0.47648727893829346,0.4845319986343384,0.4717547297477722,0.4927765130996704,0.48250359296798706,0.4789403975009918,0.4808230400085449,0.49723130464553833,0.49220043420791626,0.49434182047843933,0.48986905813217163,0.4954819083213806,0.4968757927417755,0.4968879520893097,0.49078139662742615,0.5026766657829285,0.4936281740665436,0.4938465654850006,0.4941617548465729,0.4906451404094696,0.4884297549724579,0.4897095263004303,0.48889023065567017,0.48968732357025146,0.48284363746643066,0.4703805446624756,0.48027828335762024,0.4846431612968445,0.47830653190612793,0.47400787472724915,0.47063881158828735,0.4844090938568115,0.48908936977386475,0.49187833070755005,0.5100383758544922,0.5182695388793945,0.5214661359786987,0.5442376136779785,0.553776741027832,0.5636242628097534,0.570266604423523,0.5791199207305908,0.5670091509819031,0.5490534901618958,0.5640684366226196,0.5354028344154358,0.5078877210617065,0.49572017788887024,0.47165119647979736,0.46608033776283264,0.47511523962020874,0.43220263719558716,0.4526681900024414,0.4415639340877533,0.44471877813339233,0.453139990568161,0.4496006667613983,0.42963409423828125,0.4544813632965088,0.43883538246154785,0.41174355149269104,0.4584041237831116,0.42554694414138794,0.45842498540878296,0.4576203227043152,0.44085976481437683,0.43572020530700684,0.4835623800754547,0.514413058757782,0.5381374359130859,0.5366976857185364,0.5121092796325684,0.5094010829925537,0.45953381061553955,0.4980086386203766,0.4697421193122864,0.47742846608161926,0.3997027277946472]}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}}},                        {"responsive": true}                    )                };                            </script>        </div>



Let's do the same as above for an abnormal rhythm ECG on the test dataset.


```python
encoded_data = autoencoder.encoder(abnormal_test_data).numpy()
decoded_data = autoencoder.decoder(encoded_data).numpy()


trace1 = go.Scatter(y=abnormal_test_data[0],name='Input data')
trace2 = go.Scatter(y=decoded_data[0],name='Reconstruction & error',
                         fill='tonexty')


data = [trace1,trace2]
py_offline.plot(data, filename='basic-line', include_plotlyjs=False, output_type='div')
```
<div>                            <div id="aa16bf73-cc26-4abf-ab3a-fac78ae700e0" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("aa16bf73-cc26-4abf-ab3a-fac78ae700e0")) {                    Plotly.newPlot(                        "aa16bf73-cc26-4abf-ab3a-fac78ae700e0",                        [{"name":"Input data","type":"scatter","y":[0.3687897026538849,0.30728116631507874,0.2658798396587372,0.2342016100883484,0.2289544939994812,0.24441950023174286,0.2897324562072754,0.32673344016075134,0.3450625240802765,0.35946375131607056,0.366017609834671,0.38083764910697937,0.4098110496997833,0.426404744386673,0.4301389157772064,0.42872142791748047,0.4324492812156677,0.42882904410362244,0.4317876100540161,0.4314000606536865,0.4309997260570526,0.43363940715789795,0.43189460039138794,0.4334389865398407,0.4282280206680298,0.4304920434951782,0.4316231906414032,0.43162646889686584,0.4328855872154236,0.42824631929397583,0.43387359380722046,0.4338427782058716,0.4270707368850708,0.4270402491092682,0.4258621335029602,0.42957353591918945,0.43204739689826965,0.42690134048461914,0.4267188310623169,0.42579153180122375,0.42145025730133057,0.42689019441604614,0.4192477762699127,0.42660969495773315,0.425228089094162,0.4170193672180176,0.4184109568595886,0.41961243748664856,0.41716280579566956,0.41829556226730347,0.41633373498916626,0.4121170938014984,0.4156325161457062,0.4140487611293793,0.4120148718357086,0.41335198283195496,0.4142370820045471,0.41685929894447327,0.41644006967544556,0.41624537110328674,0.4196259379386902,0.4177689850330353,0.41905897855758667,0.42218971252441406,0.4196544587612152,0.42940545082092285,0.4308989942073822,0.4307335913181305,0.4318483769893646,0.43540969491004944,0.44192975759506226,0.445151150226593,0.44695404171943665,0.4487036466598511,0.45294925570487976,0.4540736973285675,0.45773977041244507,0.4565097689628601,0.46157169342041016,0.4622882306575775,0.46499142050743103,0.46702536940574646,0.46528127789497375,0.4724016785621643,0.4684238135814667,0.4714818596839905,0.4761196970939636,0.4806874096393585,0.477120041847229,0.47579425573349,0.4818546175956726,0.48146358132362366,0.4816263020038605,0.4840543866157532,0.4852852523326874,0.48290780186653137,0.4826079308986664,0.48741355538368225,0.4890534281730652,0.49074432253837585,0.49717646837234497,0.4968552887439728,0.4969344139099121,0.5008605718612671,0.5031581521034241,0.5059995651245117,0.5076162815093994,0.5129083395004272,0.5130175948143005,0.5137396454811096,0.5173085331916809,0.5215231776237488,0.5224050283432007,0.5229285359382629,0.5217630863189697,0.5279528498649597,0.5248215794563293,0.5252198576927185,0.531267523765564,0.5323393940925598,0.5313363671302795,0.5249910354614258,0.531597912311554,0.5341436862945557,0.5397691130638123,0.5453839898109436,0.5644707083702087,0.5959868431091309,0.6098214387893677,0.6092298626899719,0.6011083722114563,0.5885306596755981,0.5727330446243286,0.5786002278327942,0.6149988770484924,0.6372957229614258,0.6170028448104858,0.5855123400688171,0.56629878282547,0.5726404190063477]},{"fill":"tonexty","name":"Reconstruction & error","type":"scatter","y":[0.4187658429145813,0.25643202662467957,0.17971700429916382,0.1416165828704834,0.14625221490859985,0.19912287592887878,0.28362882137298584,0.306428998708725,0.36866244673728943,0.40833917260169983,0.41588500142097473,0.41721493005752563,0.4349389970302582,0.4283873736858368,0.42799243330955505,0.42019379138946533,0.41183748841285706,0.4192914366722107,0.41870197653770447,0.4112783372402191,0.41204380989074707,0.41428256034851074,0.3987419009208679,0.40743571519851685,0.402587890625,0.40924328565597534,0.41743195056915283,0.3984314799308777,0.4067050516605377,0.40339693427085876,0.4046981930732727,0.38910001516342163,0.3745383322238922,0.38830700516700745,0.3803955614566803,0.38328105211257935,0.385261595249176,0.3983069062232971,0.38237297534942627,0.4034058451652527,0.3934061527252197,0.39021554589271545,0.4104977548122406,0.42409589886665344,0.41617658734321594,0.4212360382080078,0.4310763478279114,0.43970581889152527,0.43412071466445923,0.4380657970905304,0.44638338685035706,0.4434937834739685,0.44985634088516235,0.4562239944934845,0.45253682136535645,0.4610736072063446,0.45664986968040466,0.4536914527416229,0.45391586422920227,0.45723089575767517,0.4618476331233978,0.47055482864379883,0.46413254737854004,0.46391597390174866,0.47588634490966797,0.4670261740684509,0.4762842059135437,0.4825576841831207,0.4902157187461853,0.4868711531162262,0.49219056963920593,0.49171653389930725,0.4993748664855957,0.5015336275100708,0.5029653906822205,0.5024036169052124,0.5100195407867432,0.49737900495529175,0.5062448978424072,0.5006082653999329,0.4974426031112671,0.49929752945899963,0.5006028413772583,0.49739477038383484,0.50086510181427,0.49359241127967834,0.4955478608608246,0.5003208518028259,0.4959305226802826,0.49367836117744446,0.49034953117370605,0.49589961767196655,0.49691149592399597,0.49115365743637085,0.4901222288608551,0.49491578340530396,0.4970593750476837,0.5090397596359253,0.5271615386009216,0.5299252867698669,0.547936201095581,0.5641404986381531,0.5785156488418579,0.5862573981285095,0.5922874212265015,0.5971267819404602,0.5787860751152039,0.5738573670387268,0.5701033473014832,0.5513163805007935,0.5333587527275085,0.5101572871208191,0.461076021194458,0.4704042673110962,0.44186559319496155,0.4508987367153168,0.4458563029766083,0.4369012117385864,0.4401966333389282,0.4476768672466278,0.43786871433258057,0.4420301616191864,0.46228861808776855,0.43606051802635193,0.45663702487945557,0.43588000535964966,0.43653735518455505,0.46380069851875305,0.48262155055999756,0.5013130903244019,0.5355772376060486,0.5378100872039795,0.5445823073387146,0.5611144304275513,0.5552237033843994,0.5626068711280823,0.5326967239379883,0.5376222729682922,0.5379247665405273,0.4466624855995178]}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}}},                        {"responsive": true}                    )                };                            </script>        </div>



With the naked eye, the two plots above seem to suggest that the reconstruction error for the abnormal rhythm ECG is larger. We will formalize our findings in the next section.

## Detecting anomalies

Here we will compute the reconstruction error for all the data points both normal and abnormal.  For the reconstruction error, we will use the mean absolute error.
We will compute the reconstruction error of the training dataset and choose a threshold  (one standard deviation away from the mean) above which we will classify an ECG as abnormal.



```python
reconstructions = autoencoder.predict(normal_train_data)
train_loss = tf.keras.losses.mae(reconstructions, normal_train_data)

trace = go.Histogram(x=train_loss[None,:][0],name='Normal loss')
data = [trace]
py_offline.plot(data, filename='basic-line', output_type='div',show_link=False)

```
211391,0.022029345855116844,0.026302354410290718,0.027157990261912346,0.01680164784193039,0.008387161418795586,0.008498767390847206,0.027985911816358566,0.025586934760212898,0.01568439044058323,0.016096683219075203,0.009469893760979176,0.008137836121022701,0.013117722235620022,0.00981578603386879,0.019754178822040558,0.023716477677226067,0.011373510584235191,0.012996234931051731,0.009746268391609192,0.016302471980452538,0.01342841051518917,0.02581610158085823,0.02169209159910679,0.012936703860759735,0.01364431343972683,0.017301976680755615,0.012964124791324139,0.014931167475879192,0.012221221812069416,0.010499218478798866,0.010263114236295223,0.006693091243505478,0.024276796728372574,0.010609797202050686,0.013788608834147453,0.023691872134804726,0.009156736545264721,0.01788564771413803,0.033476997166872025,0.017224730923771858,0.048857253044843674,0.054865095764398575,0.013392655178904533,0.009988994337618351,0.011145461350679398,0.021978475153446198,0.025521250441670418,0.054873593151569366,0.010158225893974304,0.019124390557408333,0.007006817031651735,0.015920229256153107,0.013375983573496342,0.012476514093577862,0.008711578324437141,0.010492876172065735,0.03257785737514496,0.010262719355523586,0.013262487016618252,0.009111995808780193,0.010118254460394382,0.024522358551621437,0.018564293161034584,0.0144963962957263,0.030879586935043335,0.03181062266230583,0.021608443930745125,0.009406127966940403,0.011995286680758,0.01807991787791252,0.021077703684568405,0.02144983410835266,0.026538018137216568,0.01197922695428133,0.011582445353269577,0.009476189501583576,0.009570029564201832,0.015439670532941818,0.019648224115371704,0.020641224458813667,0.009138043038547039,0.008983932435512543,0.010758535005152225,0.04057389870285988,0.021339397877454758,0.013576066121459007,0.010500514879822731,0.020924700424075127,0.014553059823811054,0.015604738146066666,0.031864654272794724,0.013048532418906689,0.01744449883699417,0.021230703219771385,0.012435915879905224,0.019515709951519966,0.021717125549912453,0.027047686278820038,0.010542407631874084,0.009059417061507702,0.019715875387191772,0.02655862830579281,0.013817351311445236,0.015775946900248528,0.029415277764201164,0.010882481001317501,0.01860649324953556,0.023292385041713715,0.012696988880634308,0.011425098404288292,0.01055194716900587,0.008629344403743744,0.019270019605755806,0.013566174544394016,0.03018191270530224,0.0111667700111866,0.013027316890656948,0.007522538769990206,0.02715355157852173,0.011158999055624008,0.012345010414719582,0.010140972211956978,0.018242081627249718,0.011748190969228745,0.023279080167412758,0.04537269473075867,0.011796561069786549,0.023954033851623535,0.010779385454952717,0.05728384479880333,0.030567144975066185,0.00955198798328638,0.00817929394543171,0.020187726244330406,0.021158944815397263,0.02283129096031189,0.01943601854145527,0.020457908511161804,0.0416698157787323,0.0168756153434515,0.03464633971452713,0.030458519235253334,0.0200392697006464,0.0297528225928545,0.008716932497918606,0.019051862880587578,0.039002060890197754,0.014188018627464771,0.023078210651874542,0.020142843946814537,0.010056509636342525,0.014688643626868725,0.0172270480543375,0.017090030014514923,0.026316149160265923,0.015678053721785545,0.019095825031399727,0.015257407911121845,0.01078011468052864,0.012876476161181927,0.013413649052381516,0.023141223937273026,0.010184202343225479,0.025879651308059692,0.01096943486481905,0.027119675651192665,0.01282766554504633,0.02298780530691147,0.013563220389187336,0.010233537293970585,0.031849030405282974,0.050587013363838196,0.018065420910716057,0.0203366968780756,0.008531398139894009,0.015520979650318623,0.015780862420797348,0.013354216702282429,0.01246011070907116,0.010219795629382133,0.016529450193047523,0.010213744826614857,0.01555392611771822,0.013761285692453384,0.01048755832016468,0.018518906086683273,0.01144446898251772,0.016809381544589996,0.007984164170920849,0.018162570893764496,0.00984586775302887,0.013952947221696377,0.01361243799328804,0.007037859410047531,0.024363946169614792,0.00866488553583622,0.009911243803799152,0.016629310324788094,0.01164225023239851,0.024435389786958694,0.014390584081411362,0.011983714997768402,0.017101256176829338,0.020235450938344002,0.022964008152484894,0.0211527980864048,0.011629898101091385,0.010462130419909954,0.00916046928614378,0.015822380781173706,0.02320186048746109,0.01203121431171894,0.01349133625626564,0.012517367489635944,0.019388925284147263,0.020777041092514992,0.02792232669889927,0.01976267620921135,0.011815592646598816,0.014352272264659405,0.012201284058392048,0.016666244715452194,0.024746280163526535,0.011244634166359901,0.0059969499707221985,0.017063580453395844,0.010048848576843739,0.006319708656519651,0.011461606249213219,0.024755489081144333,0.013798526488244534,0.02057069167494774,0.010664123110473156,0.008511928841471672,0.023397894576191902,0.024653015658259392,0.01281781680881977,0.014444034546613693,0.008297461085021496,0.025982804596424103,0.026235252618789673,0.023257531225681305,0.012286842800676823,0.01319822110235691,0.02384662628173828,0.03100198321044445,0.022845305502414703,0.06378182023763657,0.02565585821866989,0.019162723794579506,0.013605182990431786,0.01466370653361082,0.016320815309882164,0.016400299966335297,0.011074335314333439,0.02293780818581581,0.014776614494621754,0.019078906625509262,0.01132287085056305,0.04831286519765854,0.019093215465545654,0.008509487845003605,0.008943741209805012,0.031175021082162857,0.012557411566376686,0.024005576968193054,0.01675359159708023,0.010310801677405834,0.01402070838958025,0.02187238819897175,0.010768157429993153,0.008562624454498291,0.013875712640583515,0.04906519874930382,0.007422651629894972,0.025815343484282494,0.008214084431529045,0.01630288176238537,0.009191757068037987,0.011102761141955853,0.00977304857224226,0.023283949121832848,0.013643364422023296,0.018264245241880417,0.017069410532712936,0.015432390384376049,0.02374338172376156,0.018367141485214233,0.020066438242793083,0.013347889296710491,0.020896723493933678,0.02269056998193264,0.029322229325771332,0.018130825832486153,0.01101858913898468,0.013903808780014515,0.029018525034189224,0.008354192599654198,0.024122565984725952,0.01663861609995365,0.05207257345318794,0.011796951293945312,0.021221332252025604,0.05939742550253868,0.021164527162909508,0.008609874173998833,0.025298213586211205,0.045692216604948044,0.0428219735622406,0.012061049230396748,0.013526283204555511,0.05148695036768913,0.010784866288304329,0.011467471718788147,0.010033544152975082,0.018217265605926514,0.023864733055233955,0.01918998546898365,0.02745118737220764,0.01204436831176281,0.03256303071975708,0.009261248633265495,0.02476191706955433,0.014380393549799919,0.015442391857504845,0.023552438244223595,0.006907730363309383,0.021625852212309837,0.015725912526249886,0.01600011996924877,0.009591002017259598,0.01221519336104393,0.02673383802175522,0.008633563295006752,0.011509537696838379,0.014751468785107136,0.015654996037483215,0.013577989302575588,0.04422597214579582,0.04667888954281807,0.01839207299053669,0.013854894787073135,0.01276209857314825,0.016614148393273354,0.010213316418230534,0.02586587890982628,0.02146645449101925,0.013367358595132828,0.011251766234636307,0.019812004640698433,0.012103894725441933,0.013052524998784065,0.010450480505824089,0.018149077892303467,0.009540176019072533,0.01350800134241581,0.031525686383247375,0.01385644730180502,0.009440571069717407,0.0212365984916687,0.008997293189167976,0.009412075392901897,0.015134758315980434,0.04187321662902832,0.01590939797461033,0.021292338147759438,0.01136954315006733,0.018591217696666718,0.0097179114818573,0.009906207211315632,0.00961280521005392,0.009938220493495464,0.01403447613120079,0.01063064020127058,0.010081362910568714,0.010861096903681755,0.008787008933722973,0.01189132034778595,0.01657729409635067,0.023750802502036095,0.023907430469989777,0.008423589169979095,0.009676812216639519,0.015035824850201607,0.05468575656414032,0.03764040768146515,0.02683149091899395,0.0185906533151865,0.028342870995402336,0.02067914977669716,0.018131079152226448,0.02442292310297489,0.015488534234464169,0.01433153823018074,0.009628530591726303,0.011189277283847332,0.02313261106610298,0.00784058403223753,0.05184825137257576,0.009132342413067818,0.009894980117678642,0.010319813154637814,0.013716126792132854,0.01425191294401884,0.010264591313898563,0.014661567285656929,0.008212503045797348,0.00836742389947176,0.025092510506510735,0.027686722576618195,0.03485286608338356,0.009875460527837276,0.028614653274416924,0.011437756009399891,0.020200157538056374,0.01236483920365572,0.0076205371879041195,0.014745051972568035,0.016939232125878334,0.015166671015322208,0.015495986677706242,0.01578625850379467,0.01075099129229784,0.012708865106105804,0.05051403492689133,0.025228068232536316,0.012574599124491215,0.01135900430381298,0.04874139279127121,0.036917850375175476,0.03021388128399849,0.016826579347252846,0.0170240867882967,0.006625806447118521,0.017136456444859505,0.009185271337628365,0.015477515757083893,0.017018955200910568,0.01579684391617775,0.008177473209798336,0.012778392992913723,0.024527069181203842,0.019500451162457466,0.013079581782221794,0.027844205498695374,0.008738788776099682,0.01585906744003296,0.014864640310406685,0.01388667430728674,0.011308368295431137,0.013623504899442196,0.054538846015930176,0.009124462492763996,0.05827503278851509,0.011050828732550144,0.018101897090673447,0.036326710134744644,0.0369681678712368,0.01079852320253849,0.030326373875141144,0.027594586834311485,0.018442269414663315,0.00892857275903225,0.00732742203399539,0.021615881472826004,0.008723744191229343,0.01531198900192976,0.048297617584466934,0.009438863955438137,0.020490767434239388,0.010228738188743591,0.010139438323676586,0.013111129403114319,0.02081039547920227,0.013639102689921856,0.022108931094408035,0.019292714074254036,0.021895727142691612,0.011925460770726204,0.02104813978075981,0.06332024186849594,0.04394734650850296,0.009833501651883125,0.011776527389883995,0.015054774470627308,0.015956442803144455,0.023509792983531952,0.024452684447169304,0.01670977659523487,0.03877582773566246,0.014711291529238224,0.014650937169790268,0.009477347135543823,0.021216759458184242,0.024739444255828857,0.008780885487794876,0.009062432684004307,0.009067508392035961,0.017147954553365707,0.02218765765428543,0.01985529623925686,0.011700967326760292,0.02283509448170662,0.019318554550409317,0.013192598707973957,0.0215756855905056,0.007792176678776741,0.0544244647026062,0.01169656217098236,0.01577243208885193,0.012919195927679539,0.011502140201628208,0.014649779535830021,0.02139568328857422,0.01164520625025034,0.01571664959192276,0.01939360611140728,0.009569044224917889,0.009560268372297287,0.010647051967680454,0.012774155475199223,0.011762872338294983,0.024967625737190247,0.02072550728917122,0.011996520683169365,0.017759796231985092,0.009831500239670277,0.010890090838074684,0.035070180892944336,0.010939371772110462,0.016159994527697563,0.015753325074911118,0.03362924978137016,0.03028199076652527,0.013242924585938454,0.00814462173730135,0.024717679247260094,0.008502498269081116,0.014883711002767086,0.036648571491241455,0.018722020089626312,0.009396424517035484,0.021480832248926163,0.011595485731959343,0.010678160935640335,0.011527495458722115,0.023576553910970688,0.01643543131649494,0.008354129269719124,0.01147625781595707,0.025411343201994896,0.017271077260375023,0.007558012846857309,0.023551136255264282,0.026358967646956444,0.054265011101961136,0.01059268694370985,0.023786474019289017,0.030149681493639946,0.01026404369622469,0.020547373220324516,0.020412707701325417,0.01629827171564102,0.017740322276949883,0.02989778481423855,0.0350368395447731,0.006410057190805674,0.024086926132440567,0.015197047032415867,0.02900243178009987,0.021609196439385414,0.02946491166949272,0.021385731175541878,0.008118603378534317,0.009103323332965374,0.026218323037028313,0.05084920674562454,0.021281495690345764,0.056322433054447174,0.017962343990802765,0.00951610691845417,0.014875248074531555,0.011677194386720657,0.012003687210381031,0.025795772671699524,0.014526956714689732,0.011816161684691906,0.01021815836429596,0.05509825795888901,0.014563539996743202,0.014723566360771656,0.027604540809988976,0.01791013404726982,0.025390291586518288,0.018818749114871025,0.01627781242132187,0.02152753248810768,0.008134172298014164,0.020334908738732338,0.009874027222394943,0.02279580757021904,0.013871831819415092,0.01183882262557745,0.008694227784872055,0.01978078857064247,0.020468637347221375,0.009472200646996498,0.027696924284100533,0.016835758462548256,0.0139665137976408,0.021990861743688583,0.009334440343081951,0.017641596496105194,0.07167671620845795,0.014026467688381672,0.02170390821993351,0.013502593152225018,0.027577195316553116,0.025955967605113983,0.01728234998881817,0.020009884610772133,0.02013205550611019,0.011801403015851974,0.02322668768465519,0.015892624855041504]}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}}},                        {"responsive": true}                    )                };                            </script>        </div>



We now define the threshold.


```python
threshold = np.mean(train_loss) + np.std(train_loss)
print("Threshold: ", threshold)
```

    Threshold:  0.028107813


On the test dataset, we will use the threshold above to determine anormalies. We will do this as follows:


```python
reconstructions_normal = autoencoder.predict(normal_test_data)
test_loss_normal = tf.keras.losses.mae(reconstructions_normal, normal_test_data)


reconstructions_abnormal = autoencoder.predict(abnormal_test_data)
test_loss_abnormal = tf.keras.losses.mae(reconstructions_abnormal, abnormal_test_data)


trace1 = go.Histogram(x=test_loss_normal[None,:][0],name='Normal loss')
trace2 = go.Histogram(x=test_loss_abnormal[None,:][0],name='Abnormal loss',opacity=0.4)

data = [trace1,trace2]

all_data = {"data": data,"layout": go.Layout(barmode='overlay')}

# # Overlay both histograms
# fig.update_layout(barmode='overlay')
# # Reduce opacity to see both histograms
# fig.update_traces(opacity=0.75)




# fig.add_shape(type="line",
#     xref="x", yref="y",
#     x0=threshold, y0=0, x1=threshold, y1=90,
#     line=dict(
#         color="red",
#         width=3,
#     ),
# )
py_offline.plot(all_data, filename='basic-line',output_type='div')
```
0252223015,0.012714908458292484,0.01286385953426361,0.023725735023617744,0.021345186978578568,0.0178849995136261,0.008970307186245918,0.04386996477842331,0.014300157316029072,0.009753922931849957,0.05062896013259888,0.007951769046485424,0.0130809610709548,0.016581572592258453,0.009502853266894817,0.017522133886814117,0.029571015387773514,0.01000502984970808,0.009501313790678978,0.026357097551226616,0.029641957953572273,0.00902780145406723,0.017400164157152176,0.01349003054201603,0.020158670842647552,0.01397713553160429,0.012649282813072205,0.028922390192747116,0.010831681080162525,0.028296129778027534,0.025961320847272873,0.013925041072070599,0.013152871280908585,0.012634404934942722,0.02318081073462963,0.007600296288728714,0.015503858216106892,0.017692318186163902,0.008319023996591568,0.009984562173485756,0.010146376676857471,0.007516918703913689,0.024784259498119354,0.021130463108420372,0.01239408552646637,0.008920039050281048,0.00792862568050623,0.027384433895349503,0.014730279333889484,0.01026350911706686,0.011452531442046165,0.011614875867962837,0.009110765531659126,0.014620702713727951,0.02141864039003849,0.02521120198071003,0.013341830112040043,0.02004009671509266,0.026100195944309235,0.03493091091513634,0.013051201589405537,0.025085410103201866,0.011604235507547855,0.026754282414913177,0.029182767495512962,0.021474139764904976,0.010831248946487904,0.028975779190659523,0.012020152062177658,0.015117229893803596,0.010402154177427292,0.011037741787731647,0.02145269326865673,0.019697772338986397,0.04384349286556244,0.052435606718063354,0.011279319413006306,0.010265501216053963,0.008552956394851208,0.05814709514379501,0.01563888229429722,0.0205642431974411,0.022376829758286476,0.025225907564163208,0.012828463688492775,0.019400473684072495,0.022925211116671562,0.017082560807466507,0.01657942123711109,0.020296724513173103,0.03379104286432266,0.03172558918595314,0.04810681939125061,0.013179320842027664,0.02405470609664917,0.05123676732182503,0.00886458344757557,0.027929039672017097,0.012212096713483334,0.024623293429613113,0.05771302431821823,0.01351981982588768,0.0060821156948804855,0.02497718669474125,0.021731678396463394,0.01182068232446909,0.02944958582520485,0.013750587590038776,0.021449651569128036,0.009503667242825031,0.01451841089874506,0.022551966831088066,0.023946590721607208,0.03030732274055481,0.02239188365638256,0.012514774687588215,0.0264312531799078,0.013594175688922405,0.011205559596419334,0.007526532281190157,0.010872244834899902,0.010769722983241081,0.00935120228677988,0.009723549708724022,0.011591672897338867,0.02519259788095951,0.03310585394501686,0.010283594019711018,0.024540113285183907,0.010948781855404377,0.02447400614619255,0.008926615118980408,0.011657197028398514,0.021260887384414673,0.011560115031898022,0.01478054653853178,0.011548156850039959,0.009336069226264954,0.011649231426417828,0.02258397452533245,0.028874240815639496,0.008896604180335999,0.015127917751669884,0.01334404107183218,0.009305303916335106,0.011883826926350594,0.015965893864631653,0.020275482907891273,0.03297744318842888,0.01111011765897274,0.049249157309532166,0.017961110919713974,0.017651090398430824,0.025667350739240646,0.041949935257434845,0.039312005043029785,0.028635311871767044,0.011909730732440948,0.027460740879178047,0.010372963733971119,0.012817452661693096,0.009836677461862564,0.013685506768524647,0.010395538993179798,0.012213384732604027,0.008998971432447433,0.012336610816419125,0.010516400448977947,0.00989751610904932,0.019583791494369507,0.012501632794737816,0.006459738593548536,0.02432090975344181,0.013930553570389748,0.016325199976563454,0.015411150641739368,0.029001161456108093,0.01091709639877081,0.012365249916911125,0.011535679921507835,0.017261607572436333,0.008312508463859558,0.02942653000354767,0.015894681215286255,0.02609115280210972,0.01837371475994587,0.01404520869255066,0.011729228310286999,0.03461866080760956,0.015357611700892448,0.01465542335063219]},{"name":"Abnormal loss","opacity":0.4,"type":"histogram","x":[0.044401515275239944,0.05096227675676346,0.04135730862617493,0.057256318628787994,0.04965604096651077,0.04616926237940788,0.037007562816143036,0.03984307125210762,0.04451082646846771,0.054001837968826294,0.036285024136304855,0.042112428694963455,0.04069399833679199,0.04301723092794418,0.02082529477775097,0.04691452160477638,0.04196414723992348,0.04317287728190422,0.05485112965106964,0.05247639864683151,0.04609435796737671,0.03950446844100952,0.05486835911870003,0.04441414028406143,0.043940767645835876,0.038021452724933624,0.05221559852361679,0.045401252806186676,0.08665398508310318,0.04385535418987274,0.07948600500822067,0.03961040824651718,0.05010118708014488,0.05382521450519562,0.045676130801439285,0.04619372636079788,0.03803955391049385,0.055163852870464325,0.05253377929329872,0.05239095538854599,0.04426298663020134,0.04262874647974968,0.047849804162979126,0.04612564295530319,0.04424069821834564,0.053778499364852905,0.04789697378873825,0.06460940092802048,0.04682501405477524,0.04502881318330765,0.04662506654858589,0.057491861283779144,0.054964762181043625,0.044435106217861176,0.055263858288526535,0.049326080828905106,0.049053095281124115,0.04524574428796768,0.05507989227771759,0.044825341552495956,0.03753280267119408,0.04523511603474617,0.04336696118116379,0.04492783918976784,0.048378605395555496,0.04513770341873169,0.04232984036207199,0.05048202723264694,0.056008756160736084,0.054006725549697876,0.04723217710852623,0.03577694296836853,0.039393551647663116,0.04190220311284065,0.04307933151721954,0.04537868872284889,0.043344102799892426,0.04481992498040199,0.038339849561452866,0.05402817577123642,0.047394540160894394,0.05199350044131279,0.051531095057725906,0.03713715448975563,0.045434508472681046,0.04264570772647858,0.05314360931515694,0.06450032442808151,0.04459931328892708,0.042372722178697586,0.042620182037353516,0.04669882357120514,0.06062207370996475,0.04260140657424927,0.04508310556411743,0.04403585195541382,0.04359867796301842,0.041468873620033264,0.04071933031082153,0.05009930953383446,0.04574732854962349,0.04763677343726158,0.03689587488770485,0.048952750861644745,0.04706256091594696,0.04721899703145027,0.04232267662882805,0.042702484875917435,0.040562644600868225,0.046170178800821304,0.07116255909204483,0.048255909234285355,0.04855747148394585,0.043405309319496155,0.0435258112847805,0.056351762264966965,0.05047119781374931,0.05276133865118027,0.045329462736845016,0.037632424384355545,0.04257591813802719,0.058898694813251495,0.04400103911757469,0.04518350958824158,0.06379005312919617,0.04859133064746857,0.04221978783607483,0.05427861213684082,0.04846877232193947,0.047365982085466385,0.05395721644163132,0.05564647912979126,0.044115811586380005,0.04301319643855095,0.05060706287622452,0.04249749332666397,0.041158292442560196,0.04199923202395439,0.044908106327056885,0.053215593099594116,0.04665610194206238,0.043307412415742874,0.0549224428832531,0.0446176677942276,0.05673719197511673,0.04769042506814003,0.047553859651088715,0.04467804729938507,0.04482526704668999,0.05029904469847679,0.04336518421769142,0.044426824897527695,0.04079799726605415,0.05336226895451546,0.03864965960383415,0.042710501700639725,0.0402076318860054,0.042278390377759933,0.0436713807284832,0.03876025602221489,0.045445844531059265,0.03594489023089409,0.040840405970811844,0.04310038685798645,0.04436548799276352,0.03687572851777077,0.044190745800733566,0.04675322398543358,0.0379146933555603,0.040636081248521805,0.04828064888715744,0.04426715895533562,0.05427362024784088,0.0442192405462265,0.04687310755252838,0.047470685094594955,0.047298580408096313,0.04750574007630348,0.066902756690979,0.051286954432725906,0.04259325936436653,0.04730662330985069,0.04777507111430168,0.038049016147851944,0.04133229702711105,0.03688430041074753,0.04410961642861366,0.04858280345797539,0.040780868381261826,0.049759965389966965,0.04417699575424194,0.040135759860277176,0.01777428388595581,0.049945853650569916,0.04600472375750542,0.043151091784238815,0.046967487782239914,0.04667622596025467,0.050513193011283875,0.05464562773704529,0.06148064509034157,0.04382409527897835,0.054232966154813766,0.0418747141957283,0.047029267996549606,0.05088206008076668,0.051841236650943756,0.045158110558986664,0.044238269329071045,0.041561394929885864,0.042820755392313004,0.058661509305238724,0.048318762332201004,0.04358711466193199,0.04222496226429939,0.04016490653157234,0.0509234294295311,0.04505384340882301,0.05841149762272835,0.04817342758178711,0.04745208099484444,0.04244339466094971,0.06362058967351913,0.04742015525698662,0.041529398411512375,0.04727635532617569,0.05297252535820007,0.0459023155272007,0.043350111693143845,0.0465397909283638,0.05863973870873451,0.04730873554944992,0.043209485709667206,0.04490317404270172,0.048088788986206055,0.042051345109939575,0.04378344491124153,0.04097932577133179,0.04574073106050491,0.04762842878699303,0.04352297633886337,0.057409871369600296,0.0460975356400013,0.046733614057302475,0.03927670791745186,0.04546644166111946,0.04181845858693123,0.04479362443089485,0.048510726541280746,0.04489533603191376,0.0687788724899292,0.052030690014362335,0.04643095284700394,0.04221910983324051,0.04770056903362274,0.04055003076791763,0.04158150032162666,0.056471891701221466,0.04922882467508316,0.04735293239355087,0.051840890198946,0.04449174553155899,0.04769236221909523,0.047669652849435806,0.06283900886774063,0.05331597849726677,0.05262255668640137,0.061575304716825485,0.04904783517122269,0.05191336199641228,0.03929496183991432,0.04450036957859993,0.04582100361585617,0.046232920140028,0.04869063198566437,0.04641486331820488,0.04229017719626427,0.04259843751788139,0.011785452254116535,0.054628636687994,0.048897694796323776,0.044015515595674515,0.05761358514428139,0.04211880639195442,0.039788514375686646,0.03818080946803093,0.03701618313789368,0.06689023971557617,0.04469773545861244,0.043634671717882156,0.04680155962705612,0.043394822627305984,0.04317372664809227,0.03528227284550667,0.04628602787852287,0.059483472257852554,0.04614759981632233,0.045887935906648636,0.04418828710913658,0.050385866314172745,0.04155084118247032,0.0408829003572464,0.05942295119166374,0.05198453739285469,0.04655661806464195,0.03893529623746872,0.046845387667417526,0.04335392266511917,0.06794758886098862,0.04929628223180771,0.040063340216875076,0.034291744232177734,0.038485076278448105,0.04797419160604477,0.0564909502863884,0.045650314539670944,0.04497546702623367,0.061996977776288986,0.04861709848046303,0.046939022839069366,0.04533417895436287,0.04386826604604721,0.052320510149002075,0.04049551859498024,0.05184440314769745,0.040733080357313156,0.0464138388633728,0.0481439009308815,0.0440831296145916,0.04390411451458931,0.042596518993377686,0.050610173493623734,0.042788151651620865,0.04499197378754616,0.044029638171195984,0.04439416155219078,0.047517381608486176,0.0421033538877964,0.04514075443148613,0.04610325023531914,0.04843270778656006,0.06047870218753815,0.04125785082578659,0.04798469692468643,0.045006465166807175,0.05210839956998825,0.05830010771751404,0.05302175506949425,0.0505511537194252,0.05249089002609253,0.04258466884493828,0.04707473888993263,0.04188667610287666,0.03944307565689087,0.06487823277711868,0.04878645017743111,0.050822868943214417,0.05577845126390457,0.040976300835609436,0.05817432329058647,0.04944514110684395,0.049663644284009933,0.04460616037249565,0.04635016992688179,0.049633413553237915,0.04517689719796181,0.044843923300504684,0.047998879104852676,0.04500909522175789,0.041391897946596146,0.042203325778245926,0.045289937406778336,0.033669181168079376,0.046203747391700745,0.04649920016527176,0.04461365193128586,0.051153670996427536,0.04277610033750534,0.06005949154496193,0.06335979700088501,0.03807065263390541,0.039059367030858994,0.05091341584920883,0.06160551309585571,0.0758552998304367,0.04334640875458717,0.04368392750620842,0.042333438992500305,0.05520736798644066,0.04939470812678337,0.05332452058792114,0.04641034081578255,0.042507603764534,0.06042970344424248,0.04741820693016052,0.053282201290130615,0.05978281795978546,0.05479035899043083,0.046936485916376114,0.04380188509821892,0.04327087476849556,0.05442529916763306,0.04445100203156471,0.04136141389608383,0.04638658091425896,0.045652810484170914,0.045788392424583435,0.044778842478990555,0.041419100016355515,0.04781155660748482,0.04298335686326027,0.04422232508659363,0.043376460671424866,0.04130622744560242,0.04346887394785881,0.04663590341806412,0.045960959047079086,0.04249680042266846,0.0480257086455822,0.0414227657020092,0.0592302605509758,0.051516830921173096,0.054167017340660095,0.039446961134672165,0.05553969368338585,0.04282820224761963,0.04409505054354668,0.04213770478963852,0.055452167987823486,0.04107232019305229,0.05714671313762665,0.04210164025425911,0.04738962650299072,0.04317750409245491,0.042555827647447586,0.05763528123497963,0.04631796479225159,0.04190785437822342,0.05364888906478882,0.05769580975174904]}],                        {"barmode":"overlay","template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}}},                        {"responsive": true}                    )                };                            </script>        </div>



The red vertical line is at the threshold. Anything above the red vertical line is considered as an anormaly. 

## How accurate is our model 

We will compute the accuracy, precision and recall of our model. 


```python
def predict(model, data, threshold):
  reconstructions = model(data)
  loss = tf.keras.losses.mae(reconstructions, data)
  return tf.math.less(loss, threshold)

def print_stats(predictions, labels):
  print("Accuracy = {}".format(accuracy_score(labels, predictions)))
  print("Precision = {}".format(precision_score(labels, predictions)))
  print("Recall = {}".format(recall_score(labels, predictions)))



preds = predict(autoencoder, test_data, threshold)
print_stats(preds, test_labels)
```

    Accuracy = 0.939
    Precision = 0.994059405940594
    Recall = 0.8964285714285715


## Final words

In this blog post, we have seen how autoencoders can be used to detect anomalies in our data. The ECG data is a  nice example to illustrate the idea, however, with a typical real-world use case, there will be more shortcomings. 
